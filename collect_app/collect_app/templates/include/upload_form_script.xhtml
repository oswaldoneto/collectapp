<script type="text/javascript">
	$(document).ready(function() {
		
		
		



		
		
		
		
		$('#uic_upload_form').fileupload({
			forceIframeTransport:true,
			add: function(e,data) {
				$.get("/api/document/{{params.document}}/s3",{},function(fields){
					$("input:hidden[name=AWSAccessKeyId]").val(fields.access_key_id);
					$("input:hidden[name=policy]").val(fields.policy);
					$("input:hidden[name=signature]").val(fields.signature);		
					$("input:hidden[name=acl]").val(fields.acl);		
					$("input:hidden[name=key]").val(fields.key);		
					$("input:hidden[name=success_action_status]").val("200");
					$("#uic_upload_form").attr("action",fields.bucket_url);  
					data.submit();	
				});		        
			},
			done:function(e,data) {
				$.post("/api/document/{{params.document}}/attach",{
					name:data.files[0].name,
					type:data.files[0].type,
					size:data.files[0].size
				},function(data){
					redirect("/document/{{params.document}}/preview");						
				}).error(function(){
					alert('erro'); 
				});	
			},			
		});
		
		
		
		/*
	    $("#uic_upload_form").fileupload({
			forceIframeTransport: true,
			autoUpload:false,
			add:function(e,data) {
				//TODO: Recfator 72				
				$.get("/api/document/{{params.document}}/s3",{},function(fields){
					$("input:hidden[name=AWSAccessKeyId]").val(fields.access_key_id);
					$("input:hidden[name=policy]").val(fields.policy);
					$("input:hidden[name=signature]").val(fields.signature);		
					$("input:hidden[name=acl]").val(fields.acl);		
					$("input:hidden[name=key]").val(fields.key);		
					$("input:hidden[name=success_action_status]").val("200");
					$("#uic_upload_form").attr("action",fields.bucket_url);  
				});
			},			
			done:function(e,data) {
				$.post("/api/document/{{params.document}}/attach",{
					name:data.files[0].name,
					type:data.files[0].type,
					size:data.files[0].size
				},function(data){
					redirect("/document/{{params.document}}/preview");						
				}).error(function(){
					alert('erro'); 
				});	
			},
	    });
	    */
	    
	    
	    
	});
</script>