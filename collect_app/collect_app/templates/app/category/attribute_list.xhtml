{% extends "app/category/category_base.xhtml" %}

{% block page_index %}1{% endblock %}

{% block category_script %}
	<script type="text/javascript">
		$(document).ready(function(){

			/* Setting */			
			$dialog = $("<div>Teste</div>").dialog({ autoOpen: false, modal:true});
			$uic_new_att_button = $("#uic_new_att_button").button();
			$uic_edit_att_button = $("#uic_edit_att_button").button({ disabled: true });
			$uic_del_att_button = $("#uic_del_att_button").button({ disabled: true });
			$uic_order_att_button = $("#uic_order_att_button").button();
			
			$("#uic_attribute_table").dataTable({
				"bJQueryUI": true,
				"bPaginate": false,
				"bFilter":false,
				"bSort":true,
				"bInfo":false,
				"bAutoWidth":false,
				"aoColumns": [{ "bSortable": false },null,null,{ "bSortable": false }],
				"aaSorting": [[ 1, "asc" ]],
				"oLanguage": default_oLanguage								
			});

			/* Events */
			$uic_new_att_button.click(function() {					 
				 redirect(sprintf('/category/%s/attribute/add',{{category.id}}));
			});
			$uic_edit_att_button.click(function() {					 
				 redirect(sprintf('/category/%s/attribute/%s/edit',{{category.id}},$("input:radio[name=attribute_selected]:checked").val()));
			});
			$uic_del_att_button.click(function() {					 				
				$("#uic_delete_dialog").dialog({
					title:"Excluir Atributo",
					width:400,				
					buttons: [
					{
						text: "Confirmar",
						click: function() { 
							var catId = {{category.id}};
							var attId = $("input:radio[name=attribute_selected]:checked").val();
							var delete_mode = $("input:radio[name=uic_delete_value_attr_radio]:checked").val();
							var url = null;
							if (delete_mode == 1) {
								url = sprintf('/category/%s/attribute/%s/delete', catId, attId);
							}
							else {
								url = sprintf('/category/%s/attribute/%s/inactive', catId, attId);								
							}
							$("#ui_form").attr("action", url);  
							$("#ui_form").submit(); 
						}
					},
					{
						text: "Cancelar",
						click: function() { 
							$(this).dialog("close"); 
						}
					}					
				] });
			});
			$uic_order_att_button.click(function(){
				var catId = {{category.id}};
    			$dialog.load(sprintf('/category/%s/attribute/order',catId)).dialog({title:'Ordem de Visualização de Atributos',width:500,height: 300});
    			$dialog.dialog('open',{ position: 'center' });
    			return false;								
			});			
			
			$("input:radio[name=uic_delete_value_attr_radio]").click(function() {
				var delete_mode = $("input:radio[name=uic_delete_value_attr_radio]:checked").val();
				if (delete_mode == 1) {
					$("#uic_delete_mode_alert").show();
				}
				else {
					$("#uic_delete_mode_alert").hide();
				}
			});			
			$("input:radio[name=attribute_selected]").click(function() {					 
				$( "#uic_edit_att_button" ).button({ disabled: false });
				$( "#uic_del_att_button" ).button({ disabled: false });
			});
		});
	</script>
{% endblock %}

{% block trail %}
    <ul>
        <li><a href="#">Home</a></li>
        <li>Classify</li>
        <li>Categories</li>
        <li>{{category.title}}</li>
        <li>Attributes</li>
    </ul>
{% endblock %}

{% block category_title %}
	Atributos da Categoria
{% endblock %}

{% block category_content %}	
	<form id="ui_form" method="post">
		{% csrf_token %}
		<div>
			<table id="uic_attribute_table" class="display">
				<thead>
					<tr>
						<th style="width:1%"></th>
						<th style="width:50%">Atributo</th>
						<th style="width:25%">Tipo</th>
						<th style="width:24%">Obrigatório</th>
					</tr>
				</thead>						
				<tbody>
					{% if attributes %}
					{% for attribute in attributes %}
						<tr>
							<td><input type="radio" name="attribute_selected" value="{{attribute.id}}"/></td>
							<td>{{attribute.name}}</td>
							<td>{{attribute.get_type_display}}</td>
							<td>							
								{% if attribute.required %}
									<div class="ui-icon ui-icon-check margin_auto">																				
								{% else %}
									<div class="ui-icon ui-icon-close margin_auto">																				
								{% endif %}
							</td>
						</tr>
					{% endfor %}					
					{% endif %}		
				</tbody>					
			</table>
		</div>
		<div class="ui-form-button">
			<input type="button" value="Ordenar" id="uic_order_att_button"/>
			<input type="button" value="Novo" id="uic_new_att_button"/>
			<input type="button" value="Abrir" id="uic_edit_att_button"/>
			<input type="button" value="Deletar" id="uic_del_att_button"/>
		</div>
		<div class="clear"></div>
	</form>
	
	
	<div id="uic_delete_dialog" class="margin_top_default hide">
		<div id="uic_delete_mode_alert" class="ui-widget ui-state-error ui-corner-all ui-feedback clear hide"> 
			<span class="ui-icon ui-icon-alert floatl"></span>
			<p id="uic_tag_message">Atenção haverá perda permanente de informação</p>
		</div>
		<p class="margin_bottom_default">Selecione o modo de exclusão desejada:</p>
		<div>
			<input type="radio" name="uic_delete_value_attr_radio" value="0" checked="checked"/>
			<label for="deleta_nao"><strong>Manter</strong> valores de atributo de documentos já classificados</label>
		</div>
		<div class="margin_top_default">
			<input type="radio" name="uic_delete_value_attr_radio" value="1"/>
			<label for="deleta"><strong>Deletar</strong> valores de atributo de documentos já classificados</label>
		</div>
	</div>
	
		
{% endblock %}