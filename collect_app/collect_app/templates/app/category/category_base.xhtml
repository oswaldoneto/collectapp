{% extends "layout/template.xhtml" %}

{% block title %}Collect Project :: Category{% endblock %}

{% block import_style %}
    <style type="text/css">
        @import url("{{STATIC_URL}}css/app/category.css");

        #uic_tag_table tr:first-child td:first-child {
            width: 1%;
        }

    </style>
{% endblock %}
{% block import_script %}
    <script type="text/javascript" src="{{STATIC_URL}}js/app/tag/tag-util.js"></script>
{% endblock %}

{% block startup_script %}
        <script type="text/javascript">
            $(document).ready(function(){

                /* Setting  */
                $uic_new_button = $("#uic_new_button").button({
                    text: true,
                    icons: {
                        primary: "ui-icon-document"
                    }
                });
                $uic_open_button = $("#uic_open_button").button({
                    text: true,
                    icons: {
                        primary: "ui-icon-folder-open"
                    },
                });
                $uic_delete_button = $("#uic_delete_button").button({
                    text: true,
                    icons: {
                        primary: "ui-icon-trash"
                    },
                });

                /* Events */
                $uic_new_button.click(function() {
                    redirect("/category/add");
                    return false;
                });
                $uic_open_button.click(function() {
                    redirect("/category/list");
                    return false;
                });
                $uic_delete_button.click(function() {
                    $("#uic_delete_dialog").dialog({ buttons: [
                        {
                            text: "Yes",
                            click: function() {
                                {% if category %}
                                    $("#uic_form").attr("action", sprintf('/category/%s/delete', {{category.id}}));
                                    $("#uic_form").submit();
                                    return false;
                                {% endif %}
                            }
                        },
                        {
                            text: "No",
                            click: function() {
                                $(this).dialog("close");
                            }
                        }
                    ] });
                });

                {% if category %}
                    $("#uic_tab").tabs();
                    $("#uic_tab").tabs('select',{% block page_index %}{% endblock %});
                    $("#uic_tab").bind('tabsselect',function(event,ui) {
                        var cat_id = {{category.id}}
                        var url = null;
                        switch(ui.index) {
                            case 0:
                                url = sprintf("/category/%s/edit",cat_id);
                                break;
                            case 1:
                                url = sprintf("/category/%s/attribute/list",cat_id);
                                break;
                            case 2:
                                url = sprintf("/category/%s/tag/list",cat_id);
                                break;
                        }
                        redirect(url);
                    });
                {% endif %}

                setTimeout(function() {
                   $("#uic_tag_feedback").hide("slow");
                }, 10000);

            });
        </script>
        {% block category_script %}{% endblock %}
{% endblock %}

{% block content %}

    <div class="ui-app-header">
        <div class="ui-app-title">{% block category_title %}{% endblock %}</div>
        <div class="ui-app-command">
            <button id="uic_new_button">Novo</button>
            <button id="uic_open_button">Abrir</button>
            <button id="uic_delete_button">Deletar</button>
        </div>
    </div>

    {% if messages %}
        <div id="uic_tag_feedback" class="ui-widget ui-state-error ui-corner-all ui-feedback clear">
            <span class="ui-icon ui-icon-alert floatl"></span>
            <p id="uic_tag_message">{% for message in messages %}{{ message }}{% endfor %}</p>
        </div>
    {% endif %}

    {% if category %}
        <div id="uic_tab">
            <ul>
                <li><a href="#category">Categoria</a></li>
                <li><a href="#attributes">Atributos</a></li>
                <li><a href="#tag">Tag</a></li>
            </ul>
            <div id="category"></div>
            <div id="attributes"></div>
            <div id="tag"></div>
    {% endif %}
    {% block category_content %}{% endblock %}
    {% if category %}
        </div>
    {% endif %}

    <div id="uic_delete_dialog" class="hide">Deseja excluir a categoria selecionada?</div>
{% endblock %}